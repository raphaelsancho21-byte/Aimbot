-- Carregar biblioteca Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Variáveis de configuração
local AimbotSettings = {
    Enabled = false,
    TeamCheck = false,
    AliveCheck = true,
    WallCheck = true,
    AimKey = "Enum.UserInputType.MouseButton2", -- Botão Direito do Mouse por padrão
    SnapToTarget = false,
    SnapDistance = 300,
    SnapKey = "Q",
    Smoothing = 0.5,
    FOVEnabled = true,
    FOVRadius = 100,
    FOVColor = Color3.fromRGB(255, 255, 255),
    TargetPart = "Head",
    -- Triggerbot
    Triggerbot = false,
    -- ESP
    ESP_Enabled = false,
    ESP_Box = false,
    ESP_Names = false,
    -- Performance
    RaycastTick = 0,
    RaycastInterval = 0.1 -- Segundos entre cada checagem de visibilidade (mais leve)
}

-- Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Cache de Visibilidade para Performance
local VisibilityCache = {}

-- Círculo de FOV (Drawing Library)
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 60
FOVCircle.Radius = AimbotSettings.FOVRadius
FOVCircle.Filled = false
FOVCircle.Visible = AimbotSettings.FOVEnabled
FOVCircle.Color = AimbotSettings.FOVColor
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

-- Armazenamento de desenhos ESP
local ESP_Holders = {}

local function CreateESP(Player)
    if not Player or ESP_Holders[Player] then return end
    local Box = Drawing.new("Square")
    Box.Visible = false
    Box.Color = Color3.fromRGB(255, 0, 0)
    Box.Thickness = 1
    Box.Filled = false
    
    local Name = Drawing.new("Text")
    Name.Visible = false
    Name.Color = Color3.fromRGB(255, 255, 255)
    Name.Size = 16
    Name.Center = true
    Name.Outline = true
    
    ESP_Holders[Player] = {Box = Box, Name = Name}
end

local function RemoveESP(Player)
    if ESP_Holders[Player] then
        ESP_Holders[Player].Box:Remove()
        ESP_Holders[Player].Name:Remove()
        ESP_Holders[Player] = nil
    end
end

-- Inicializar ESP para jogadores atuais
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then CreateESP(player) end
end

Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)

-- Função para checar se a tecla/botão está pressionado (Suporta Mouse e Teclado)
local function IsKeyPressed(InputString)
    if not InputString then return false end
    
    -- Se for botão do mouse
    if string.find(InputString, "MouseButton") then
        local Button = InputString:match("MouseButton%d")
        if Button == "MouseButton1" then return UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) end
        if Button == "MouseButton2" then return UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) end
    end
    
    -- Se for tecla do teclado
    local Key = InputString:gsub("Enum.KeyCode.", "")
    local success, keyCode = pcall(function() return Enum.KeyCode[Key] end)
    if success and keyCode then
        return UserInputService:IsKeyDown(keyCode)
    end
    
    return false
end

-- Função Wallcheck com Cache
local function GetVisibility(Player)
    local curTime = tick()
    if VisibilityCache[Player] and (curTime - VisibilityCache[Player].LastUpdate) < AimbotSettings.RaycastInterval then
        return VisibilityCache[Player].Color, VisibilityCache[Player].IsVisible
    end

    local Character = Player.Character
    if not Character or not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("Head") then 
        return Color3.fromRGB(255, 0, 0), false
    end
    
    local Head = Character:FindFirstChild("Head")
    local Torso = Character:FindFirstChild("HumanoidRootPart") or Character:FindFirstChild("Torso")
    if not Head or not Torso then return Color3.fromRGB(255, 0, 0), false end

    local HeadVisible = #Camera:GetPartsObscuringTarget({LocalPlayer.Character.Head.Position, Head.Position}, {LocalPlayer.Character, Character}) == 0
    local TorsoVisible = #Camera:GetPartsObscuringTarget({LocalPlayer.Character.Head.Position, Torso.Position}, {LocalPlayer.Character, Character}) == 0

    local color = Color3.fromRGB(255, 0, 0)
    local visible = false

    if HeadVisible then
        color = Color3.fromRGB(0, 255, 0)
        visible = true
    elseif TorsoVisible then
        color = Color3.fromRGB(255, 255, 0)
        visible = true
    end

    VisibilityCache[Player] = {Color = color, IsVisible = visible, LastUpdate = curTime}
    return color, visible
end

-- Função para encontrar o jogador mais próximo dentro do FOV ou 3D
local function GetClosestPlayer()
    local Target = nil
    local MaxDist = AimbotSettings.FOVRadius
    local ClosestDistance3D = AimbotSettings.SnapDistance

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(AimbotSettings.TargetPart) and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            if AimbotSettings.TeamCheck and player.Team == LocalPlayer.Team then continue end
            if AimbotSettings.AliveCheck and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health <= 0 then continue end
            
            local TargetPart = player.Character[AimbotSettings.TargetPart]
            local _, visible = GetVisibility(player)
            if AimbotSettings.WallCheck and not visible then continue end
            
            if AimbotSettings.SnapToTarget and IsKeyPressed(AimbotSettings.SnapKey) then
                local Dist3D = (LocalPlayer.Character.HumanoidRootPart.Position - TargetPart.Position).Magnitude
                if Dist3D < ClosestDistance3D then
                    ClosestDistance3D = Dist3D
                    Target = player
                end
            elseif not AimbotSettings.SnapToTarget then
                local ScreenPos, OnScreen = Camera:WorldToViewportPoint(TargetPart.Position)
                if OnScreen then
                    local MousePos = UserInputService:GetMouseLocation()
                    local Dist = (Vector2.new(ScreenPos.X, ScreenPos.Y) - MousePos).Magnitude
                    if Dist < MaxDist then
                        MaxDist = Dist
                        Target = player
                    end
                end
            end
        end
    end
    return Target
end

-- Janela do Rayfield (Matrix Theme & Key System)
local Window = Rayfield:CreateWindow({
    Name = "Sirius HUB | Elite V4",
    LoadingTitle = "Sirius HUB Otimizado",
    LoadingSubtitle = "Performance & Controle",
    Theme = {
        TextColor = Color3.fromRGB(0, 255, 0),
        Background = Color3.fromRGB(0, 10, 0),
        Topbar = Color3.fromRGB(0, 20, 0),
        Shadow = Color3.fromRGB(0, 0, 0),
        NotificationBackground = Color3.fromRGB(0, 15, 0),
        NotificationActionsBackground = Color3.fromRGB(0, 25, 0),
        TabBackground = Color3.fromRGB(0, 12, 0),
        TabStroke = Color3.fromRGB(0, 40, 0),
        TabBackgroundSelected = Color3.fromRGB(0, 100, 0),
        TabTextColor = Color3.fromRGB(0, 200, 0),
        SelectedTabTextColor = Color3.fromRGB(0, 255, 0),
        ElementBackground = Color3.fromRGB(0, 15, 0),
        ElementBackgroundHover = Color3.fromRGB(0, 30, 0),
        SecondaryElementBackground = Color3.fromRGB(0, 18, 0),
        ElementStroke = Color3.fromRGB(0, 50, 0),
        SecondaryElementStroke = Color3.fromRGB(0, 40, 0),
        SliderBackground = Color3.fromRGB(0, 80, 0),
        SliderProgress = Color3.fromRGB(0, 255, 0),
        SliderStroke = Color3.fromRGB(0, 120, 0),
        ToggleBackground = Color3.fromRGB(0, 25, 0),
        ToggleEnabled = Color3.fromRGB(0, 255, 0),
        ToggleDisabled = Color3.fromRGB(0, 50, 0),
        ToggleEnabledStroke = Color3.fromRGB(0, 200, 0),
        ToggleDisabledStroke = Color3.fromRGB(0, 60, 0),
        ToggleEnabledOuterStroke = Color3.fromRGB(0, 150, 0),
        ToggleDisabledOuterStroke = Color3.fromRGB(0, 40, 0),
        InputBackground = Color3.fromRGB(0, 15, 0),
        InputStroke = Color3.fromRGB(0, 50, 0),
        PlaceholderColor = Color3.fromRGB(0, 100, 0)
    },
    ConfigurationSaving = { Enabled = true, FolderName = "SiriusScripts", FileName = "AimbotConfig" },
    KeySystem = true,
    KeySettings = {
        Title = "Aimlock Key System",
        Subtitle = "STUDIOSRAW",
        Note = "by Sirius AI",
        FileName = "StudiosRaw",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"STUDIOS", "RAW", "STUDIOSRAW"}
    }
})

local CombatTab = Window:CreateTab("Combat", 4483362458)
local VisualTab = Window:CreateTab("Visuals", 4483362458)

CombatTab:CreateSection("Aimbot")
CombatTab:CreateToggle({Name = "Ativar Aimbot", CurrentValue = false, Callback = function(v) AimbotSettings.Enabled = v end})

CombatTab:CreateKeybind({
    Name = "Tecla da Mira (Hold)",
    CurrentKeybind = "MouseButton2",
    HoldToInteract = false,
    Callback = function(k) AimbotSettings.AimKey = tostring(k) end
})

CombatTab:CreateSlider({
    Name = "Suavização",
    Range = {0, 1},
    Increment = 0.05,
    CurrentValue = 0.5,
    Callback = function(v) AimbotSettings.Smoothing = v end
})

CombatTab:CreateSection("Snap 360")
CombatTab:CreateToggle({Name = "Snap to Target", CurrentValue = false, Callback = function(v) AimbotSettings.SnapToTarget = v end})
CombatTab:CreateKeybind({Name = "Tecla do Snap", CurrentKeybind = "Q", HoldToInteract = false, Callback = function(k) AimbotSettings.SnapKey = tostring(k) end})
CombatTab:CreateSlider({Name = "Distância do Snap", Range = {50, 1000}, Increment = 50, CurrentValue = 300, Callback = function(v) AimbotSettings.SnapDistance = v end})

CombatTab:CreateSection("Extras")
CombatTab:CreateToggle({Name = "Wall Check", CurrentValue = true, Callback = function(v) AimbotSettings.WallCheck = v end})
CombatTab:CreateToggle({Name = "Triggerbot", CurrentValue = false, Callback = function(v) AimbotSettings.Triggerbot = v end})

VisualTab:CreateSection("ESP")
VisualTab:CreateToggle({Name = "Ativar ESP", CurrentValue = false, Callback = function(v) AimbotSettings.ESP_Enabled = v end})
VisualTab:CreateToggle({Name = "Box ESP", CurrentValue = false, Callback = function(v) AimbotSettings.ESP_Box = v end})
VisualTab:CreateToggle({Name = "Name ESP", CurrentValue = false, Callback = function(v) AimbotSettings.ESP_Names = v end})

VisualTab:CreateSection("Performance")
VisualTab:CreateSlider({
    Name = "Intervalo Raycast (Leve)",
    Range = {0, 0.5},
    Increment = 0.05,
    CurrentValue = 0.1,
    Callback = function(v) AimbotSettings.RaycastInterval = v end
})

-- Loop Principal (Aimbot, Triggerbot, ESP)
RunService.RenderStepped:Connect(function()
    pcall(function()
        FOVCircle.Position = UserInputService:GetMouseLocation()
        
        -- Lógica de Aimbot / Auto-Rotate
        if AimbotSettings.Enabled then
            local isAiming = IsKeyPressed(AimbotSettings.AimKey)
            local isSnapping = AimbotSettings.SnapToTarget and IsKeyPressed(AimbotSettings.SnapKey)
            
            if isAiming or isSnapping then
                local TargetPlayer = GetClosestPlayer()
                if TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild(AimbotSettings.TargetPart) then
                    local TargetPart = TargetPlayer.Character[AimbotSettings.TargetPart]
                    local TargetCFrame = CFrame.new(Camera.CFrame.Position, TargetPart.Position)
                    if isSnapping then
                        Camera.CFrame = TargetCFrame
                    else
                        Camera.CFrame = Camera.CFrame:Lerp(TargetCFrame, AimbotSettings.Smoothing)
                    end
                end
            end
        end
        
        -- Lógica de Triggerbot
        if AimbotSettings.Triggerbot then
            local Mouse = LocalPlayer:GetMouse()
            local Target = Mouse.Target
            if Target and Target.Parent and Target.Parent:FindFirstChild("Humanoid") then
                local tp = Players:GetPlayerFromCharacter(Target.Parent)
                if tp and (not AimbotSettings.TeamCheck or tp.Team ~= LocalPlayer.Team) then
                    mouse1press(); task.wait(0.01); mouse1release()
                end
            end
        end
        
        -- Lógica de ESP com CORES DINÂMICAS
        for player, drawings in pairs(ESP_Holders) do
            if AimbotSettings.ESP_Enabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
                local Root = player.Character.HumanoidRootPart
                local Pos, OnScreen = Camera:WorldToViewportPoint(Root.Position)
                if OnScreen then
                    local color, _ = GetVisibility(player)
                    
                    -- Box ESP
                    if AimbotSettings.ESP_Box then
                        local Top = Camera:WorldToViewportPoint(Root.Position + Vector3.new(0, 3, 0))
                        local Bot = Camera:WorldToViewportPoint(Root.Position - Vector3.new(0, 3, 0))
                        local Size = math.abs(Top.Y - Bot.Y)
                        
                        drawings.Box.Size = Vector2.new(Size * 0.6, Size)
                        drawings.Box.Position = Vector2.new(Pos.X - drawings.Box.Size.X / 2, Pos.Y - drawings.Box.Size.Y / 2)
                        drawings.Box.Color = color
                        drawings.Box.Visible = true
                    else drawings.Box.Visible = false end
                    
                    -- Name ESP
                    if AimbotSettings.ESP_Names then
                        drawings.Name.Text = player.Name .. " [" .. math.floor((Root.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude) .. "m]"
                        drawings.Name.Position = Vector2.new(Pos.X, Pos.Y + (drawings.Box.Size.Y / 2) + 5)
                        drawings.Name.Color = color
                        drawings.Name.Visible = true
                    else drawings.Name.Visible = false end
                else drawings.Box.Visible = false; drawings.Name.Visible = false end
            else drawings.Box.Visible = false; drawings.Name.Visible = false end
        end
    end)
end)

-- Carregar Configuração ao Final
Rayfield:LoadConfiguration()
```
